<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="d3.js"></script>
  <link rel="stylesheet" href="/styles/main.css" media="screen" title="no title" charset="utf-8">
  <title>Home Page</title>
</head>

<body>
  {{{body}}}
  <svg></svg>
</body>
<script>
  $.get("/api/data", function(data){
    var svgWidth = 500, svgHeight = 300, radius = Math.min(svgWidth, svgHeight) / 2;
var svg = d3.select('svg')
    .attr("width", svgWidth)
    .attr("height", svgHeight);


var g = svg.append("g")
    .attr("transform", "translate(" + radius + "," + radius + ")");

var color = d3.scaleOrdinal(d3.schemeCategory10);

var pie = d3.pie().value(function(d) {
    return d.hours;
});

var path = d3.arc()
    .outerRadius(radius)
    .innerRadius(0);

var arc = g.selectAll("arc")
    .data(pie(data))
    .enter()
    .append("g");

arc.append("path")
    .attr("d", path)
    .attr("fill", function(d) { 
        return color(d.data.hours);
     });

var label = d3.arc()
     .outerRadius(radius)
     .innerRadius(0);

arc.append("text")
     .attr("transform", function(d) {
         return "translate(" + label.centroid(d) + ")";
     })
     .attr("text-anchor", "middle")
     .text(function(d) {
         return d.data.projects + ":" + d.data.hours + "%";
     });
})
</script>
</html>
